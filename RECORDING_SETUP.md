# Налаштування запису Twilio Video Room

## Огляд

Додано функціональність запису відеодзвінків для нотаріусів. Запис використовує Twilio Video Compositions API для створення MP4 файлів з відео та аудіо всіх учасників.

## Налаштування

### 1. Оновлення змінних середовища

Додайте до `server/.env`:
```env
TWILIO_AUTH_TOKEN=your_auth_token
SERVER_URL=http://localhost:4000
```

### 2. Встановлення залежностей

Сервер вже має необхідні залежності, але переконайтеся що встановлено:
```bash
cd server
npm install
```

### 3. Запуск сервера

```bash
cd server
npm run dev
```

### 4. Запуск клієнта

```bash
cd client
npm run dev
```

## Використання

### Для нотаріуса:

1. Відкрийте додаток як нотаріус
2. Підключіться до кімнати
3. Натисніть червону кнопку запису (кругла кнопка з іконкою запису)
4. Запис почнеться автоматично
5. Для зупинки запису натисніть кнопку зупинки (квадратна кнопка)

### Для клієнта:

1. Клієнт може бачити статус запису в панелі інформації
2. Клієнт не може керувати записом (тільки нотаріус)

## Технічні деталі

### API Endpoints

- `POST /api/recording/start` - Почати запис
- `POST /api/recording/stop` - Зупинити запис (тільки статус)
- `GET /api/recording/:recordingSid` - Отримати статус запису
- `POST /api/recording/status` - Callback для статусу

### Типи записів

Запис створюється як Twilio Video Composition з:
- Формат: MP4
- Аудіо: Всі учасники
- Відео: Grid layout з усіма учасниками
- Автоматичне завершення при закритті кімнати

### Статуси запису

- `enqueued` - Запис поставлений в чергу
- `processing` - Запис обробляється
- `completed` - Запис завершено
- `failed` - Помилка запису

## Обмеження

1. **Запис не можна зупинити вручну** - він завершується автоматично при закритті кімнати
2. **Потрібен TWILIO_AUTH_TOKEN** - для роботи з Compositions API
3. **Запис створюється асинхронно** - файл буде доступний через деякий час після завершення

## Troubleshooting

### Помилка "Recording start failed"
- Перевірте TWILIO_AUTH_TOKEN
- Переконайтеся що кімната існує
- Перевірте логи сервера

### Запис не створюється
- Перевірте що в кімнаті є учасники з відео/аудіо
- Перевірте статус кімнати в Twilio Console

### Файл не доступний
- Зачекайте кілька хвилин - обробка може тривати
- Перевірте статус через API або Twilio Console

## Безпека та конфіденційність

⚠️ **ВАЖЛИВО**: Перед використанням запису:
1. Отримайте згоду всіх учасників
2. Дотримуйтесь місцевого законодавства
3. Інформуйте учасників про запис
4. Зберігайте записи безпечно

## Вартість

Twilio стягує плату за:
- Час запису
- Зберігання файлів
- Обробку композицій

Перевірте актуальні тарифи на [twilio.com/pricing](https://www.twilio.com/pricing)

